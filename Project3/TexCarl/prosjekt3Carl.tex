\documentclass[reprint,english,notitlepage]{revtex4-1}  % defines the basic parameters of the document

% if you want a single-column, remove reprint

% allows special characters (including æøå)
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{float}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
%% note that you may need to download some of these packages manually, it depends on your setup.
%% I recommend downloading TeXMaker, because it includes a large library of the most common packages.

\usepackage{physics,amssymb}  % mathematical symbols (physics imports amsmath)
\usepackage{graphicx}         % include graphics such as plots
\usepackage{xcolor}           % set colors
\usepackage{hyperref}         % automagic cross-referencing (this is GODLIKE)
\usepackage{tikz}             % draw figures manually
\usepackage{listings}         % display code
\usepackage{subfigure}        % imports a lot of cool and useful figure commands

% defines the color of hyperref objects
% Blending two colors:  blue!80!black  =  80% blue and 20% black
\hypersetup{ % this is just my personal choice, feel free to change things
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}}

%% Defines the style of the programming listing
%% This is actually my personal template, go ahead and change stuff if you want
\lstset{ %
	inputpath=,
	backgroundcolor=\color{white!88!black},
	basicstyle={\ttfamily\scriptsize},
	commentstyle=\color{magenta},
	language=Python,
	morekeywords={True,False},
	tabsize=4,
	stringstyle=\color{green!55!black},
	frame=single,
	keywordstyle=\color{blue},
	showstringspaces=false,
	columns=fullflexible,
	keepspaces=true}


%% USEFUL LINKS:
%%
%%   UiO LaTeX guides:        https://www.mn.uio.no/ifi/tjenester/it/hjelp/latex/ 
%%   mathematics:             https://en.wikibooks.org/wiki/LaTeX/Mathematics

%%   PHYSICS !                https://mirror.hmc.edu/ctan/macros/latex/contrib/physics/physics.pdf

%%   the basics of Tikz:       https://en.wikibooks.org/wiki/LaTeX/PGF/TikZ
%%   all the colors!:          https://en.wikibooks.org/wiki/LaTeX/Colors
%%   how to draw tables:       https://en.wikibooks.org/wiki/LaTeX/Tables
%%   code listing styles:      https://en.wikibooks.org/wiki/LaTeX/Source_Code_Listings
%%   \includegraphics          https://en.wikibooks.org/wiki/LaTeX/Importing_Graphics
%%   learn more about figures  https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions
%%   automagic bibliography:   https://en.wikibooks.org/wiki/LaTeX/Bibliography_Management  (this one is kinda difficult the first time)
%%   REVTeX Guide:             http://www.physics.csbsju.edu/370/papers/Journal_Style_Manuals/auguide4-1.pdf
%%
%%   (this document is of class "revtex4-1", the REVTeX Guide explains how the class works)


%% CREATING THE .pdf FILE USING LINUX IN THE TERMINAL
%% 
%% [terminal]$ pdflatex template.tex
%%
%% Run the command twice, always.
%% If you want to use \footnote, you need to run these commands (IN THIS SPECIFIC ORDER)
%% 
%% [terminal]$ pdflatex template.tex
%% [terminal]$ bibtex template
%% [terminal]$ pdflatex template.tex
%% [terminal]$ pdflatex template.tex
%%
%% Don't ask me why, I don't know.

\begin{document}
\title{This is a Very Important Title!}   % self-explanatory
\author{Person McSomething}               % self-explanatory
\date{\today}                             % self-explanatory
\noaffiliation                            % ignore this
\begin{abstract}                          % marks the beginning of the abstract
This abstract is abstract.                % the body of the abstract
\end{abstract}                            % marks the end of the abstract
\maketitle                                % creates the title, author, date & abstract

If you want to learn more about using \LaTeX, you should check UiO's official tutorials:
\url{https://www.mn.uio.no/ifi/tjenester/it/hjelp/latex/}

If you are familiar with \LaTeX\ and you want to learn more about the REVTeX4-1 document class, check:
\url{http://www.physics.csbsju.edu/370/papers/Journal_Style_Manuals/auguide4-1.pdf}


% the fundamental components of scientific reports:
\section{Introdukson}

\section{Teori}   % (optional)
Legger vi til flere partikler i systemet som kan påvirke hverandre med Coloumb krefter, så får vi en bevegelse som ser slik ut:
$$
\ddot{x}_i -\omega_{0,i} \ddot{y}_i-\frac{1}{2}\omega_{z,i}^2x_i-k_e\frac{q_e}{m_i}\sum_{j\neq i}q_j\frac{x_i-x_j}{|\vec{r}_i-\vec{r}_j|^3}=0
$$
$$
\ddot{y}_i -\omega_{0,i} \ddot{x}_i-\frac{1}{2}\omega_{z,i}^2y_i-k_e\frac{q_e}{m_i}\sum_{j\neq i}q_j\frac{y_i-y_j}{|\vec{r}_i-\vec{r}_j|^3}=0
$$
$$
\ddot{z}_i+w_{z,i}^20z_i-k_e\frac{q_e}{m_i}\sum_{j\neq i}q_j\frac{z_i-z_j}{|\vec{r}_i-\vec{r}_j|^3}=0
$$
Som det vil bli forklart dypere hvordan i Metode-delen skal vi bruke to numeriske metoder for å simulere banen. Den ene er Eulers meotde og den andre er Runge Kutta 4. For Euler-Cromer vil vi ha en feilorden av orden $O(h^)$
\section{Metode}
\subsection*{Enpartikkelsystemet}
Vi starter først med et enpartikkelsystem. Vi setter partikkelen i samme posisjon som i den analytiske delen, altså
$$
\vec{r}(0)=\begin{bmatrix}
x_0 \\ 0 \\0
\end{bmatrix}
$$
og
$$
\vec{v}=\begin{bmatrix}
0\\v_0\\0
\end{bmatrix}
$$
hvor vi setter $x_0=1\mu m$ og $v_0=1\frac{\mu m}{\mu s}$ for enkelhetsskyld. Vi bruker så at det elektriske feltet kan skrives som
$$
\vec{E}=\begin{Bmatrix}
V0\frac{x}{d^2} \\V_0 \frac{y}{d^2}\\-2V_0 \frac{z}{d^2}
\end{Bmatrix}
$$

og det magnetiske feltet er $\vec{B}=(0,0,B_0)$. Vi vet også at den eksterne kraften er gitt som
$$
\vec{F}_{eks}=q\vec{E}+q\vec{v}\cross \vec{B}
$$
og slik kan vi regne ut den eksterne kraften.
Så skal vi bruke dette som kraften når vi bruker de numeriske metodene.
Vi starter med Eulers metode som er ganske rett fram:
\begin{algorithm}[H]
	\begin{algorithmic}
		\State Some maths, e.g $f(x) = x^2$. 
		\For{$i = 0, 1, ..., N-1$}
		\State $$
		r_{i+1}\leftarrow r_i+v_i \cdot h
		$$
		\State $$
		v_{i+1}\leftarrow v_i+\frac{F(r_i, v_i)}{m}\cdot h
		$$
		\EndFor
	\end{algorithmic}
\end{algorithm}
Runge Kutta 4 er litt mer komplisert:
\begin{algorithm}[H]
	\begin{algorithmic}
		\State Some maths, e.g $f(x) = x^2$. 
		\For{$i = 0, 1, ..., N-1$}
		\State $$
		R\leftarrow r_i
		$$$$
		V\leftarrow v_i
		$$$$
		vk_1\leftarrow h\cdot F(r_i, v_i)
		$$$$
		rk_1\leftarrow h\cdot v_i
		$$$$
		v_{i+1}\leftarrow V+vk1/2.0
		$$$$
		r_{i+1}\leftarrow R+rk1/2.0
		$$
		$$
		vk_2\leftarrow h\cdot \frac{F(r_{i+1},v_{i+1})}{m}
		$$$$
		rk_2\leftarrow h\cdot v_{i+1}
		$$
		$$
		v_{i+1}\leftarrow V+vk_2/2
		$$$$
		r_{i+1}=R+rk_2/2
		$$
		$$
		vk_3\leftarrow h\cdot F(r_{i+1}, v_{i+1})/m
		$$$$
		rk_3\leftarrow h\cdot v_{i+1}
		$$
		$$
		v_{i+1}\leftarrow V+vk_3$$$$
		r_{i+1}\leftarrow R+rk_3
		$$
		$$
		vk_4\leftarrow h\cdot  F(r_{i+1}, v_{i+1})/m$$$$
		rk_4=h\cdot v_{i+1}
		$$
		$$
		v_{i+1}=V+(vk_1+2vk_2+2vk_3+vk_4)/6$$$$
		r_{i+1}=R+(rk_1+2rk_2+2rk_3+rk_4)/6;
		$$
		\EndFor
	\end{algorithmic}
\end{algorithm}
Vi vil så teste om $\omega_z=\frac{2qV_0}{md^2}$ er den samme i den numeriske som den analytiske. Vi tester dette ved å vite at $\omega_z$ er vinkelhastigheten til hasitgheten i $z$-retning som gir oss $\omega_z=\frac{2\pi}{T}=2\pi f$ hvor $f$ er frekvensen. Så da regner vi ut $f=\frac{\omega_z}{2\pi}$ og ganger dette med $100\mu s$ for å finne antall perioder den analytiske løsningen har over tidsrommet. Så plotter vi hasithgeten i z-retingen og teller antall perioder og sammnenlikner.
Vi finner så hva som blir feilen i systemet vårt. Vi kan regne analytiske målingen av systemet vårt $r\vec{r}_a$ som forklart tidligere. Så har vi vår numeriske løsning $\vec{r}_n$ regnet ut som over. Vi har så den absolutte feilen gitt ved
$$
err_{abs}=|\vec{r}_{a}-\vec{r}_{n}|
$$
og den relative feilen er da
$$
err_{re}=\frac{err_{abs}}{|\vec{r}|}
$$
Så gjør vi dette for hvert tidssteg slik at
$$
err_{re_i}=\frac{|\vec{r}_{a_i}-\vec{r}_{n_i}|}{|\vec{r}_{a_i}|}
$$
Vi gjør dette med $h=10^{-i}$ hvor $i=0,1,2,3,4$ og finner ulike grafer for feilene med både Euler og Runge Kutta 4.
\subsection*{Topartikkelsystemet}
I simulasjonene for topartikkelsystemet vil vi kun bruke Runge Kutta 4. Vi setter en ny partikkel i posisjonen $\vec{r}_2=\begin{pmatrix}
-1\\0\\0
\end{pmatrix}
$ og hastigheten $v_2=\begin{pmatrix}
1\\1\\1
\end{pmatrix}$
Så bruker vi samme metode som i ènpartikkelsystemet med Runge Kutta 4 på de to partiklene.
\newline  Så skal vi legge til en partikkelkraft mellom partiklene. Kraften på partikkel $j$ fra alle andre partiler $i$ er gitt ved
$$
\vec{Fp}_{ji}=k_e q_j \sum_{i\neq j} q_i \frac{\vec{r_j}-\vec{r_i}}{|\vec{r}_j-\vec{r}_i|^3}
$$
som vi da legger til i kraften for hver partikkel, slik at totalkraften på en partikkel blir
$$
\vec{F}_i=\vec{F}_{Eks_i}+\vec{Fp}_i
$$
Så bruker vi Runge Kutta 4 med denne nye kraften.
\section{Resultater}
\subsection*{Énpartikkelsystemet}
Vi fikk at i ènpartikkelsystemet så ble posisjonene som gitt i figurene \ref{r1x}, \ref{r1y} og \ref{r1z}.
\begin{figure}[H]
	\label{r1x}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/r1x.pdf}
	\caption{Posisjonen i x-retning for en partikkel alene i systemet.}
\end{figure}
\begin{figure}[H]
	\label{r1y}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/r1y.pdf}
	\caption{Posisjonen i y-retning for en partikkel alene i systemet.}
\end{figure}
\begin{figure}[H]
	\label{r1z}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/r1z.pdf}
	\caption{Posisjonen i z-retning for en partikkel alene i systemet.}
\end{figure}
Av den analytiske løsningen var $\omega_z=\frac{2qV_0}{md^2}$ som med våre verdier gir $\omega_z=0,982Hz$. Da får vi at antall perioder over $100 \mu s$ blir litt over rundt femten og en halv. Vi ser på grafen og teller og får sånn ca. femten og en halv der også.
Hastigheten fra den numeriske løsningen ble som i figur \ref{v1z}.
\begin{figure}[H]
	\label{v1z}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/vz.pdf}
	\caption{Hastigheten i z-retning for en partikkel alene i fella.}
\end{figure}
De relative feilene for Eulers metode over tiden ble seende ut som i figur \ref{errEu}, mens de relative feilene for Runge-Kutta 4 er gitt i figur \ref{errRK4}
\begin{figure}[H]
	\label{errEu}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/RelerrEu.pdf}
	\caption{De relative feilene over tiden for ulike tidssteg ved bruke av Eulers metode}
\end{figure}
\begin{figure}[H]
	\label{errRK4}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/RelerrRK4.pdf}
	\caption{De relative feilene over tiden for ulike tidssteg ved å bruke Runge Kutta 4}
\end{figure}
For Eulers metode fikk vi at konvergesraten ble $err_{Rate_{Eu}}=66,658$, mens for Runge Kutta 4 fikk $err_{Rate_{RK4}}=13,009$.
\subsection*{To-partikkelsystemet}
Partiklene uten interaksjon vil se ut som i figur \ref{r2noint} i xy-planet.
\begin{figure}[H]
	\label{r2noint}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/xypartnoint.pdf}
	\caption{To partikler som ikke gir forveksler kraft med hverandre i feltet}
\end{figure}
Partiklene med interaksjon ble derimot seende ut som på figur \ref{r2int} i xy-planet
\begin{figure}[H]
	\label{r2int}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/xypartint.pdf}
	\caption{To partikler i feltet som også kan virke på hverandre.}
\end{figure}
I tre dimensjoner vil banene se ut som i figur \ref{3dnoint} uten partikkelinteraksjon, mens banene med partikkelinteraksjon vil se ut som de i figur \ref{3dint}.
\begin{figure}[H]
	\label{3dnoint}
	\centering
	\includegraphics[scale=0.4]{../pythonplots/3dr2noint.pdf}
	\caption{Partiklenes baner i 3 dimensjoner uten partikkelinteraksjon.}
\end{figure}[H]
\begin{figure}
	\label{3dint}
	\centering
	\includegraphics[scale=0.4]{../pythonplots/3dr2int.pdf}
	\caption{Partikelenes baner i 3 dimensjoner med partikkelinteraksjon.}
\end{figure}
Fasediagrammene til partiklene uten påvirkning ble seende ut som figur \ref{fasenoint1} for den første partikkelen og figur \ref{fasenoint2} for den andre partikkelen. Fasediagrammene til partiklene med påvirkning fra den andre partikkelen ble som i figur \ref{faseint1} for den første partikkelen og \ref{faseint2} for den andre.
\begin{figure}[H]
	\label{fasenoint1}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/xnoint1.pdf}
	\includegraphics[scale=0.4]{../pythonplots/ynoint1.pdf}
	\includegraphics[scale=0.4]{../pythonplots/znoint1.pdf}
	\caption{Fasediagrammene for partikkel 1 i x, y og z-retning uten partikkelkrefter. Verdiene er skalert i mikrometer og mikrometer per mikrosekund}
\end{figure}
\begin{figure}[H]
	\label{fasenoint2}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/xnoint2.pdf}
	\includegraphics[scale=0.4]{../pythonplots/ynoint2.pdf}
	\includegraphics[scale=0.4]{../pythonplots/znoint2.pdf}
	\caption{Fasediagrammene for partikkel 2 i x, y og z-retning uten partikkelkrefter. Verdiene er skalert i mikrometer og mikrometer per mikrosekund}
\end{figure}
\begin{figure}[H]
	\label{faseint1}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/xint1.pdf}
	\includegraphics[scale=0.4]{../pythonplots/yint1.pdf}
	\includegraphics[scale=0.4]{../pythonplots/zint1.pdf}
	\caption{Fasediagrammene for partikkel 1 i x, y og z-retning med partikkelkraft. Verdiene er skalert i mikrometer og mikrometer per mikrosekund}
\end{figure}
\begin{figure}[H]
	\label{faseint2}
	\centering 
	\includegraphics[scale=0.4]{../pythonplots/xint2.pdf}
	\includegraphics[scale=0.4]{../pythonplots/yint2.pdf}
	\includegraphics[scale=0.4]{../pythonplots/zint2.pdf}
	\caption{Fasediagrammene for partikkel 2 i x, y og z-retning med partikkelkraft. Veridene er skalert i mikrometer og mikrometer per mikrosekund}
\end{figure}

\section{Diskusjon}
\subsection*{Énpartikkelsystemet}
Vi ser at $\omega_z$ for den numeriske løsningen er ved øymål lik den analytiske $\omega_z$ som forsterker troen på at simuleringen vår er en god tilnærming.
Vi ser at når for små tidsteg som $h=10^{-3}$ og $h=10^{-4}$, så fungerer både Eulers metode og Runge Kutta 4 ganske bra. Når vi derimot beveger oss fra $h=10^{-2}$ og oppover blir Euler mer og mer unøyaktig og feilen stiger lineært med tiden. Dette er fordi Euler ikke er god på å rette seg i oscillerende systemer.
\newline Runge-Kutta 4 derimot er holder seg ganske nærme null for alle testene av tidsteg utenom $h=1$, som gir mening siden $h$ burde være mindre enn 1 for at det skal konvergere.
\subsection*{Topartikkelsystemet}
Vi ser at når partikkelene ikke påvirker hverandre følger de baner som likner enpartikkelsystemet, som kan tyde på at denne simuleringen fungerer. Man kan tross alt se på de to partiklene som to uavhengige énpartikkelsystemer. Når vi skrur på interaksjonen derimot, så ser vi noe ganske annet. Vi kan fortsatt se noen tendenser til et liknende mønster, for eksempel at det fortsatt er sirkelbevegelse inni en større sirkelbevegelse, men vi ser også at partiklene har mye større baner enn før. Dette kan være fordi partiklene startet kun noen mikrometer nærme hverandre og partikkelkraften mellom dem har derfor blitt veldig sterk og skutt dem ut i større baner. Her har de kanskje blitt langt fra hverandre og kreftene mellom dem har blitt mindre. Da vil de eksterne kreftene ha mer å si igjen og de begynner å likne mer på énpartikkelsystemer igjen. Da vil de også gå i baner igjen, men større baner enn før, som stemmer med figuren siden vi gikk fra en bane med radius på rundt $1\mu m$ til en bane med radius rundt $10\mu m$.
\newline Vi ser av fasediagrammet at i et systemet uten interaksjon mellom partiklene så er ser det ut til å være et system av sirkler. Det gir mening siden også partikkelen danner sirkler over $xy$-planet. I $z$-retning er den mer sirkulær som gir mening siden denne kun er en cosinus funksjon. Når vi legger på partikkelinteraksjon får vi derimot mindre regelrette diagrammer. Hasitgheten og posisjonen går også fra $1.5m/s$ og $1\mu m$ til $60m/s$ og $20\mu m$. Dette samstemmer med hva vi så i $xy$-planet hvor partiklen gikk fort langt ut fordi de var veldig nærme hverandre i starten og hadde stor påvirknning på hverandre.
\section{Conklusjon}
% acknowledgements (optional)
\begin{acknowledgments}  % if you disagree with the spelling, blame Americans
I would like thank myself for writing this beautiful document.
\end{acknowledgments}


%% When it comes to the bibliography I personally generate it using BibLaTeX. (see the link above if you're interested)
%% You're obviously allowed to create the references section however you like.
%% I'll keep it simple here.
\section*{References}  % the asterisk (*) after \section makes the section numbering go away
\begin{itemize}
\item[-]Reference 1
\item[-]Reference 2
\end{itemize}

\newpage
%% if you want to include an appendix, this is how you do it
\appendix
\section{Name of appendix}
This will be the body of the appendix.
\section{This is another appendix}\label{appendix}
Tada.
%% all \section commands following \appendix are automatically taken as appendices

%% Note that \label{appendix} command on line 115. What this does is setup a reference point for LaTeX that you can
%% access wherever you want using \ref{appendix}.
%% You can place labels on most environments such as equations, figures, tables, etc.

\clearpage
Note that this document is written in the two-column format. If you want to display a large equation, a large figure, or whatever, in one-column format, you can do this like so:
\onecolumngrid
\vspace{1cm} % some extra space
This text and this equation are both in one-column format.

\footnote{This equation is actually from quantum mechanics. ``It's called Schrödinger's Time-Dependent Wave Equation'', named after the awesome Austrian physicist Erwin Rudolf Josef Alexander Schrödinger. Yep, the ``Schrödinger's cat'' guy. Pretty cool dude actually, check his wiki page: \url{https://en.wikipedia.org/wiki/Erwin_Schrodinger}. He was physics' no. 1 Ladies' man if there ever was one. Anyway, you will learn more about this equation in FYS2140. You can also find it printed on a glass wall in the UiO Physics Building (it really is that important).}

\begin{equation}\label{equation}
\frac{-\hbar^2}{2m}\laplacian{\Psi}+V\Psi=i\hbar\pdv{t}\Psi
\end{equation}
Note that the equation numbering (this: \ref{equation}) follows the appendix as this text is technically inside Appendix \ref{appendix}. If you want a detailed listing of (almost) every available math command, check: \url{https://en.wikibooks.org/wiki/LaTeX/Mathematics}.
\vspace{1cm} % some extra space
\twocolumngrid
And now we're back to two-column format. It's really easy to switch between the two. It's recommended to keep the two-column format, because it is easier to read, it's not very cluttered, etc. Pro Tip: You should also get used to working with REVTeX because it is really helpful in FYS2150.

One last thing, this is a code listing:
\begin{lstlisting}
This will be displayed with a cool programming font!
\end{lstlisting}
You can add extra arguments using optional parameters:
\begin{lstlisting}[morekeywords={cool}]
This will be displayed with a cool programming font!
\end{lstlisting}
You can also list code from a file using \texttt{lstinputlisting}. If you're interested, check \url{https://en.wikibooks.org/wiki/LaTeX/Source_Code_Listings}.

This is a basic table:
\begin{table}[h]  % h = "here"  , h! = here!
\caption{This is a nice table}\label{table}
\begin{tabular}{|c|c|c|} % note that & separates columns while \\ separates the rows
\hline                    % creates a horizontal line (try removing it)
Hey & Hey & Hey  \\
\hline
Hello & Hello & Hello \\
\hline
Bye & Bye & Bye \\
\hline
\end{tabular}
\end{table}\\
You can a detailed description of tables here: \url{https://en.wikibooks.org/wiki/LaTeX/Tables}.

I'm not going to delve into Tikz in any level detail, but here's a quick picture:
\begin{figure}[h]
\centering  % places the tikz image in the center of the text column
\begin{tikzpicture}
\draw[->] (0,0) -- (2,0) node [pos=1.0,below] {\(x\)};
\draw[->] (0,0) -- (0,2) node [pos=1.0,left] {\(y\)};
\draw (0,0) -- (1.5,1.5) node [pos=1.0,above] {\(f(x)\)};
\end{tikzpicture}
\caption{This is great caption}\label{figure}
\end{figure}\\
If you want to know more, check: \url{https://en.wikibooks.org/wiki/LaTeX/PGF/TikZ}.

%% If you want to include figure:
%\includegraphics[scale=1.0]{filename}
%% check https://en.wikibooks.org/wiki/LaTeX/Importing_Graphics if you want to know more

\end{document}
